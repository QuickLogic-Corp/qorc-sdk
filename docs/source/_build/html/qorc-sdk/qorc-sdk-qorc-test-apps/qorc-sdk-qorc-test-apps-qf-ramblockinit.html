

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>QuickFeather FPGA RAM Block Init Test &mdash; QORC-SDK  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="QuickFeather USB Speed Test" href="qorc-sdk-qorc-test-apps-qf-usbspeed.html" />
    <link rel="prev" title="QuickFeather Baremetal Test" href="qorc-sdk-qorc-test-apps-qf-baremetal.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/qorc_whitebg.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../qorc-setup/qorc-setup.html">Setup</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../qorc-sdk.html">QORC-SDK</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../qorc-sdk-hal/qorc-sdk-hal.html">QORC-SDK HAL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../qorc-sdk-libraries/qorc-sdk-libraries.html">QORC-SDK Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../qorc-sdk-s3-gateware/qorc-sdk-s3-gateware.html">QORC-SDK EOS S3 FPGA Designs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../qorc-sdk-qf-apps/qorc-sdk-qf-apps.html">QuickFeather Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../qorc-sdk-qf-vr-apps/qorc-sdk-qf-vr-apps.html">QORC Voice Recognition apps</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="qorc-sdk-qorc-test-apps.html">QORC Test Applications</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="qorc-sdk-qorc-test-apps-qf-baremetal.html">QuickFeather Baremetal Test</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">QuickFeather FPGA RAM Block Init Test</a><ul class="simple">
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="qorc-sdk-qorc-test-apps-qf-usbspeed.html">QuickFeather USB Speed Test</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../qorc-example-apps/qorc-example-apps.html">QORC Example Applications</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../ql-symbiflow/ql-symbiflow.html">QuickLogic FPGA Toolchain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ql-development-boards/ql-development-boards.html">QuickLogic Development Boards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ql-eos-s3/ql-eos-s3.html">QuickLogic EOS S3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ql-faq/ql-faq.html">FAQ</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">QORC-SDK</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../qorc-sdk.html">QORC-SDK</a> &raquo;</li>
        
          <li><a href="qorc-sdk-qorc-test-apps.html">QORC Test Applications</a> &raquo;</li>
        
      <li>QuickFeather FPGA RAM Block Init Test</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/qorc-sdk/qorc-sdk-qorc-test-apps/qorc-sdk-qorc-test-apps-qf-ramblockinit.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="quickfeather-fpga-ram-block-init-test">
<h1>QuickFeather FPGA RAM Block Init Test<a class="headerlink" href="#quickfeather-fpga-ram-block-init-test" title="Permalink to this headline">¶</a></h1>
<p>This is a test app to exercise the fpga loader to initialize the RAM blocks using the RAM initialization values prescribed in the HEX files in the FPGA design directory.
This also exercises the ability of the QuickLogic FPGA toolchain to use the HEX files to generate the RAM initialization values.</p>
<p>The RAM initialization values are in addition to the FPGA bitstream.</p>
<p>In the header generation method, where the FPGA bitstream is represented as a C array, the RAM initialization values are also represented as another C array in the FPGA header produced.
In the binary generation method, the FPGA bitstream and the RAM initialization values are present in a specific format in the FPGA binary produced.
Similarly, in the debugger script generation methods (currently JLink and OpenOCD scripts), the RAM initialization values are present.</p>
<p>In the current application, the header generation method is used, which produces a header file, which contains the FPGA bitstream, and the RAM Initialization values.</p>
<p>The header file generated is <code class="code docutils literal notranslate"><span class="pre">fpga/rtl/top_bit.h</span></code> and has the following structure</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">uint32_t</span>      <span class="n">axFPGABitStream</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>

<span class="o">/*</span> <span class="mi">32</span> <span class="n">bit</span> <span class="n">values</span> <span class="n">which</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">FPGA</span> <span class="n">bitstream</span> <span class="n">to</span> <span class="n">be</span> <span class="n">programmed</span> <span class="o">*/</span>

<span class="p">};</span>

<span class="n">uint32_t</span>   <span class="n">axFPGAMemInit</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>

<span class="o">/*</span> <span class="n">RAM</span> <span class="n">Block</span> <span class="mi">0</span> <span class="o">*/</span>
<span class="mh">0x40018000</span><span class="p">,</span> <span class="mh">0x400</span><span class="p">,</span> <span class="o">/*</span> <span class="n">START</span> <span class="n">ADDR</span><span class="p">,</span> <span class="n">NUMBER</span> <span class="n">OF</span> <span class="n">WORDS</span><span class="o">*/</span>
<span class="n">VALUES</span><span class="p">,</span>

<span class="o">...</span> <span class="n">repeated</span> <span class="k">for</span> <span class="n">number</span> <span class="n">of</span> <span class="n">RAM</span> <span class="n">Blocks</span> <span class="n">to</span> <span class="n">be</span> <span class="n">initialized</span><span class="o">.</span>
<span class="p">};</span>

<span class="n">uint32_t</span>   <span class="n">axFPGAIOMuxInit</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>

<span class="n">REG</span><span class="p">,</span><span class="n">VALUE</span>
<span class="o">...</span> <span class="n">repeated</span> <span class="k">for</span> <span class="n">number</span> <span class="n">of</span> <span class="n">PADs</span> <span class="n">used</span> <span class="n">by</span> <span class="n">the</span> <span class="n">FPGA</span>
<span class="o">...</span> <span class="ow">and</span> <span class="n">overall</span> <span class="n">MUX</span> <span class="n">settings</span>
<span class="p">};</span>
</pre></div>
</div>
<p>To load the FPGA bitstream, and perform RAM initialization, the following API is used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">load_fpga_with_mem_init</span><span class="p">(</span><span class="n">axFPGABitStream_length</span><span class="p">,</span> <span class="n">axFPGABitStream</span><span class="p">,</span> <span class="n">axFPGAMemInit_length</span><span class="p">,</span> <span class="n">axFPGAMemInit</span><span class="p">)</span>
</pre></div>
</div>
<p>Refer to <code class="code docutils literal notranslate"><span class="pre">src/fpga_design.c</span></code> and <code class="code docutils literal notranslate"><span class="pre">src/fpga_design.h</span></code> for one method of using the <code class="code docutils literal notranslate"><span class="pre">fpga/rtl/top_bit.h</span></code> FPGA arrays in <code class="code docutils literal notranslate"><span class="pre">src/main.c</span></code> to call the FPGA Loader API.</p>
<p>The implementation of the FPGA Loader API can be found in <code class="code docutils literal notranslate"><span class="pre">qorc-sdk/Libraries/FPGA/fpga_loader.c</span></code>.</p>
<ul>
<li><p>Setup:</p>
<ul>
<li><div class="line-block">
<div class="line">Ensure to use the latest FPGA toolchain which supports generation of RAM Initialization (v1.3.0 or above)</div>
<div class="line"><br /></div>
<div class="line">Alternatively, FPGA toolchain daily build can be setup as below:</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>export INSTALL_DIR=/path/to/fpga/toolchain/install
wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O conda_installer.sh
bash conda_installer.sh -b -p $INSTALL_DIR/conda &amp;&amp; rm conda_installer.sh
source &quot;$INSTALL_DIR/conda/etc/profile.d/conda.sh&quot;
echo &quot;include-system-site-packages=false&quot; &gt;&gt; $INSTALL_DIR/conda/pyvenv.cfg
CONDA_FLAGS=&quot;-y --override-channels -c defaults -c conda-forge&quot;
conda update $CONDA_FLAGS -q conda
curl $(curl https://storage.googleapis.com/symbiflow-arch-defs-install/latest) &gt; arch.tar.gz
tar -C $INSTALL_DIR -xvf arch.tar.gz &amp;&amp; rm arch.tar.gz
conda install $CONDA_FLAGS -c quicklogic-corp/label/ql yosys=&quot;0.8.0_0002_gc3b38fdc 20200901_073908&quot; python=3.7
conda install $CONDA_FLAGS -c quicklogic-corp/label/ql yosys-plugins=&quot;1.2.0_0009_g9ab211c 20201001_121833&quot;
conda install $CONDA_FLAGS -c quicklogic-corp/label/ql vtr=&quot;v8.0.0_rc2_2894_gdadca7ecf 20201008_140004&quot;
conda install $CONDA_FLAGS -c quicklogic-corp iverilog
conda install $CONDA_FLAGS -c tfors gtkwave
conda install $CONDA_FLAGS make lxml simplejson intervaltree git pip
conda activate
pip install python-constraint
pip install serial
pip install git+https://github.com/QuickLogic-Corp/quicklogic-fasm
conda deactivate
</pre></div>
</div>
</li>
<li><div class="line-block">
<div class="line">Initialize the FPGA toolchain to use.</div>
<div class="line"><br /></div>
<div class="line">Export the environment variable <code class="code docutils literal notranslate"><span class="pre">$INSTALL_DIR</span></code> using:</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">INSTALL_DIR</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">fpga</span><span class="o">/</span><span class="n">toolchain</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">where <code class="code docutils literal notranslate"><span class="pre">$INSTALL_DIR</span></code> points to the base path of the FPGA toolchain install directory</div>
<div class="line"><br /></div>
<div class="line">Initialize the conda env for the toolchain using:</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">PATH</span><span class="o">=</span><span class="s2">&quot;$INSTALL_DIR/quicklogic-arch-defs/bin:$INSTALL_DIR/quicklogic-arch-defs/bin/python:$PATH&quot;</span>
<span class="n">source</span> <span class="s2">&quot;$INSTALL_DIR/conda/etc/profile.d/conda.sh&quot;</span>
<span class="n">conda</span> <span class="n">activate</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>Build:</p>
<ul class="simple">
<li><p>Build as usual using <code class="code docutils literal notranslate"><span class="pre">make</span></code> from the <code class="code docutils literal notranslate"><span class="pre">GCC_Project</span></code> dir</p></li>
<li><p>The FPGA header is generated in <code class="code docutils literal notranslate"><span class="pre">fpga/rtl</span></code> as <code class="code docutils literal notranslate"><span class="pre">top_bit.h</span></code> and The M4 binary is generated in <code class="code docutils literal notranslate"><span class="pre">GCC_Project/output/bin</span></code> which is built including the FPGA header internally.</p></li>
</ul>
</li>
<li><p>Flash:</p>
<ul>
<li><p>Set the board in programming mode.</p></li>
<li><div class="line-block">
<div class="line">Flash the m4 binary (from the <code class="code docutils literal notranslate"><span class="pre">GCC_Project</span></code> directory)</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qfprog</span> <span class="o">--</span><span class="n">port</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">ttyACM0</span> <span class="o">--</span><span class="n">m4app</span> <span class="n">output</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">qf_ramblockinit</span><span class="o">.</span><span class="n">bin</span> <span class="o">--</span><span class="n">mode</span> <span class="n">m4</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">Note the <code class="code docutils literal notranslate"><span class="pre">--mode</span></code> option at the end, which is now mandatory - this specifies the operating mode which the bootloader uses.</div>
<div class="line"><code class="code docutils literal notranslate"><span class="pre">--mode</span> <span class="pre">m4</span></code> ensures that the bootloader knows that the m4app binary is flashed, and it will load the flashed m4app binary.</div>
<div class="line"><br /></div>
</div>
</li>
</ul>
</li>
<li><p>Run:</p>
<ul>
<li><div class="line-block">
<div class="line">Ensure that a (3.3V) USB-UART cable is connected to the EOS S3 UART pins.</div>
<div class="line">For QuickFeather, refer to <a class="reference external" href="https://github.com/QuickLogic-Corp/quick-feather-dev-board#advanced">quick-feather-dev-board</a> for details.</div>
<div class="line">Connect a Serial Terminal app to the USB port of the USB-UART cable (most likely a ttyUSBx device) at 115200 baud and 8N1 configuration.</div>
</div>
</li>
<li><p>Reset the board, m4app should get loaded by the bootloader and start running.</p></li>
<li><p>You should see a banner similar to below on the EOS S3 UART:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TODO</span><span class="p">,</span> <span class="n">fill</span> <span class="n">the</span> <span class="n">banner</span> <span class="n">printout</span> <span class="n">here</span><span class="o">.</span>
</pre></div>
</div>
</li>
<li><div class="line-block">
<div class="line">If there are any errors in the RAM initialization, you would see <code class="code docutils literal notranslate"><span class="pre">FPGA</span> <span class="pre">Load</span> <span class="pre">Failed!</span></code></div>
<div class="line">Hopefully, you would not get a chance to see this message…</div>
<div class="line"><br /></div>
</div>
</li>
</ul>
</li>
</ul>
<div class="toctree-wrapper compound">
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="qorc-sdk-qorc-test-apps-qf-usbspeed.html" class="btn btn-neutral float-right" title="QuickFeather USB Speed Test" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="qorc-sdk-qorc-test-apps-qf-baremetal.html" class="btn btn-neutral float-left" title="QuickFeather Baremetal Test" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, QuickLogic Corp

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>